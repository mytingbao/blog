---
layout: post
title: 2022年7月的技术笔记
date: 2022-07-22 08:09:50 +0800
img: 20.jpg
tags: [技术杂谈, '2022']
author: fangfang
description: 2022年7月的技术笔记
---

我个人在7月份的笔记，不定期更新

# typescript - 找不到参数类型为“字符串”的索引签名

个人习惯用策略模式去优化多个if/switch case的代码，
```typescript
 getTitle(name: any) {
    const mapping={
      ApproveList: '签署审批',
      signRecord: '签署记录',
    }
    return mapping[name]
  }
```
但在ts下你可能会得到以下报错：

{% highlight javascript %}
const mapping: {
    ApproveList: '签署审批',
    signRecord: '签署记录',
}
Element implicitly has an 'any' type because expression of type 'any' can't be used to index type '{ ApproveList: string; signRecord: string; }'.ts(7053)
{% endhighlight %}

原因是ts并不知道你传入的string索引，是否在对象中有对应的成员属性

知道问题了，我们就可以对应的解决方法：
1. 声明一个类型。限制构成对象属性的字符串
2. 以这个类型作为key，生成策略匹配的对象
3. 以这个type类型作为函数参数

```typescript
type RouteNames = 'ApproveList' | 'signRecord'

getTitle(name: RouteNames) {
    const mapping: Record<RouteNames, string> = {
      ApproveList: '签署审批',
      signRecord: '签署记录',
  
    }
    return mapping[name]
  }

this.title = this.getTitle(routeName as RouteNames) || ''
```

# 如何选择第三方 NPM 包？

* 检查开源许可证
* 看贡献频率和下载量
* 权衡包体积大小
* 是否有大型开发团队在进行维护
* 评估安全性

## 检查开源许可证（License）

开源许可证是一种法律许可。通过它，版权拥有人明确允许，用户可以免费地使用、修改、共享版权软件。

版权法默认禁止共享，也就是说，没有许可证的软件，就等同于保留版权，虽然开源了，用户只能看看源码，不能用，一用就会侵犯版权。所以软件开源的话，必须明确地授予用户开源许可证。

License 通常分两大类："CopyLeft（著佐权）" 和 "Permissive（宽松式）"：

CopyLeft：如果你使用了这个包，那么你的代码也必须开源。这对一些商业化的项目不太友好，比如 GPL 和 LGPL 协议。

Permissive：对包做了最低限度的使用限制，允许闭源，可以说几乎没有限制，但是各自又有一些区别，具体见下图。


![Flower and water]({{site.baseurl}}/images/post/202207/06.webp)

## 评估安全性

包安全性是选择 NPM 包的另一个关键因素，在仓库的「Security」tab 下可以看到它的安全策略。

![Flower and water]({{site.baseurl}}/images/post/202207/07.png)

如果维护者已经采取了措施来确保安全性，会显示已激活。

> 对于项目中已有的 NPM 依赖，可以使用命令 npm audit 来进行安全性检查。


参考链接：
* [开源许可证教程](https://www.ruanyifeng.com/blog/2017/10/open-source-license-tutorial.html)



# 统一前端项目的 Node 版本和包管理器
## 锁定项目 Node 版本

通过在 package.json 中指定 engines 字段，可限定项目使用的 node 版本。
下面配置仅允许用户使用 14 或者 16的版本。更多的配置可以参考  package.json 、npm Docs 、semver

{% highlight javascript %}
 // package.json 
  "engines": {
    "node": "14.x || 16.x"
  },
{% endhighlight %}

配置之后你会发现，该字段只对 yarn 生效。那如何对 npm 也生效呢？在项目根目录下的 .npmrc 文件中增加如下配置

{% highlight javascript %}
// .npmrc
engine-strict = true,
{% endhighlight %}

以上配置完成后，npm install 试试吧，错误的 Node.js 将直接退出


## 锁定包管理器

利用 only-allow 工具包、npm scripts 快速实现锁定。

步骤一：在项目中 npm install -D only-allow

步骤二：在 package.json 文件中进行配置 scripts.preinstall ， 允许输入的值 only-allow npm、only-allow pnpm、only-allow yarn

{% highlight javascript %}
// package.json
"scripts": {
    "preinstall": "only-allow npm",
    ...
}
{% endhighlight %}

以上配置完成后，可以再乱用 （yarn、npm、pnpm） 试试